

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Python学习笔记（四）</title>
    <meta name="description" content="Python学习笔记">
    <meta name="author" content="龙棠博客">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link href="/assets/themes/bootstrap-3/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/css/syntax.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/custom.css" rel="stylesheet" type="text/css" media="all">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body style="height:3000px">
    <div id="wrap">
      <div id="logo"><a href="/"><img src="/images/logo.png"/></a>
      <iframe width="190" height="90" style="float:right;margin-right:150px" class="share_self" frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&amp;width=190&amp;height=90&amp;fansRow=2&amp;ptype=0&amp;speed=0&amp;skin=8&amp;isTitle=0&amp;noborder=0&amp;isWeibo=0&amp;isFans=0&amp;uid=1804200020&amp;verifier=fafe682b&amp;dpc=1"></iframe>
      </div>
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <!--div id="logo"><a href="/"><img src="/images/logo.png"/></a></div-->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <!--a class="navbar-brand" href="/">龙棠博客</a-->
          <a class="navbar-brand" href="/">首页</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
      	
      	<li><a href="/10-categories.html">分类</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/20-tags.html">标签</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/30-archive.html">归档</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/40-about-me.html">关于</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  




          </ul>
          <form class="navbar-form navbar-right" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">搜索</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        

<div class="page-header">
  <h1>Python学习笔记（四） </h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>2014-03-01</span>
    </div>
    <div class="content">
      
<h2 id="python">Python多线程</h2>
<p>函数式：调用thread模块中的start_new_thread()函数来产生新线程</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">thread</span><span class="o">.</span><span class="n">start_new_thread</span> <span class="p">(</span> <span class="n">function</span><span class="p">,</span> <span class="n">args</span><span class="p">[,</span> <span class="n">kwargs</span><span class="p">]</span> <span class="p">)</span></code></pre></div>

<ul>
  <li>function - 线程函数。</li>
  <li>args - 传递给线程函数的参数,他必须是个tuple类型。</li>
  <li>kwargs - 可选参数。</li>
</ul>

<p>实例</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/python</span>
<span class="c"># -*- coding: UTF-8 -*-</span>

<span class="kn">import</span> <span class="nn">thread</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c"># 为线程定义一个函数</span>
<span class="k">def</span> <span class="nf">print_time</span><span class="p">(</span> <span class="n">threadName</span><span class="p">,</span> <span class="n">delay</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">print</span> <span class="s">"</span><span class="si">%</span><span class="s">s: </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span> <span class="n">threadName</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="p">)</span>

<span class="c"># 创建两个线程</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">start_new_thread</span><span class="p">(</span> <span class="n">print_time</span><span class="p">,</span> <span class="p">(</span><span class="s">"Thread-1"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">start_new_thread</span><span class="p">(</span> <span class="n">print_time</span><span class="p">,</span> <span class="p">(</span><span class="s">"Thread-2"</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">)</span> <span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">"Error: unable to start thread"</span>

<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">pass</span></code></pre></div>

<p>现成模块其他方法：
- threading.currentThread(): 返回当前的线程变量。
- threading.enumerate(): 返回一个包含正在运行的线程的list。正在运行指线程启动后、结束前，不包括启动前和终止后的线程。
- hreading.activeCount(): 返回正在运行的线程数量，与len(threading.enumerate())有相同的结果。</p>

<p>Thread类提供方法：
- run(): 用以表示线程活动的方法。
- start():启动线程活动。
- join([time]): 等待至线程中止。这阻塞调用线程直至线程的join() 方法被调用中止-正常退出或者抛出未处理的异常-或者是可选的超时发生。
- isAlive(): 返回线程是否活动的。
- getName(): 返回线程名。
- setName(): 设置线程名。</p>

<h3 id="threading">使用Threading模块创建线程</h3>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/python</span>
<span class="c"># -*- coding: UTF-8 -*-</span>

<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">exitFlag</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">myThread</span> <span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>   <span class="c">#继承父类threading.Thread</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">counter</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threadID</span> <span class="o">=</span> <span class="n">threadID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                   <span class="c">#把要执行的代码写到run函数里面 线程在创建后会直接运行run函数 </span>
        <span class="k">print</span> <span class="s">"Starting "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">print_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">"Exiting "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">def</span> <span class="nf">print_time</span><span class="p">(</span><span class="n">threadName</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">counter</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">counter</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exitFlag</span><span class="p">:</span>
            <span class="n">thread</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">"</span><span class="si">%</span><span class="s">s: </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">threadName</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
        <span class="n">counter</span> <span class="o">-=</span> <span class="mi">1</span>

<span class="c"># 创建新线程</span>
<span class="n">thread1</span> <span class="o">=</span> <span class="n">myThread</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"Thread-1"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">thread2</span> <span class="o">=</span> <span class="n">myThread</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">"Thread-2"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c"># 开启线程</span>
<span class="n">thread1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">thread2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">print</span> <span class="s">"Exiting Main Thread"</span></code></pre></div>

<h3 id="section">线程同步</h3>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/python</span>
<span class="c"># -*- coding: UTF-8 -*-</span>

<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">myThread</span> <span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">counter</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threadID</span> <span class="o">=</span> <span class="n">threadID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">"Starting "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="c"># 获得锁，成功获得锁定后返回True</span>
        <span class="c"># 可选的timeout参数不填时将一直阻塞直到获得锁定</span>
        <span class="c"># 否则超时后将返回False</span>
        <span class="n">threadLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="n">print_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="c"># 释放锁</span>
        <span class="n">threadLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">print_time</span><span class="p">(</span><span class="n">threadName</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">counter</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">counter</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">"</span><span class="si">%</span><span class="s">s: </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">threadName</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
        <span class="n">counter</span> <span class="o">-=</span> <span class="mi">1</span>

<span class="n">threadLock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
<span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c"># 创建新线程</span>
<span class="n">thread1</span> <span class="o">=</span> <span class="n">myThread</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"Thread-1"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">thread2</span> <span class="o">=</span> <span class="n">myThread</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">"Thread-2"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c"># 开启新线程</span>
<span class="n">thread1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">thread2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c"># 添加线程到线程列表</span>
<span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread1</span><span class="p">)</span>
<span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread2</span><span class="p">)</span>

<span class="c"># 等待所有线程完成</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
    <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="k">print</span> <span class="s">"Exiting Main Thread"</span></code></pre></div>

<h3 id="queue">线程优先级队列（ Queue）</h3>

<ul>
  <li>Queue.qsize() 返回队列的大小</li>
  <li>Queue.empty() 如果队列为空，返回True,反之False</li>
  <li>Queue.full() 如果队列满了，返回True,反之False</li>
  <li>Queue.full 与 maxsize 大小对应</li>
  <li>Queue.get([block[, timeout]])获取队列，timeout等待时间</li>
  <li>Queue.get_nowait() 相当Queue.get(False)</li>
  <li>Queue.put(item) 写入队列，timeout等待时间</li>
  <li>Queue.put_nowait(item) 相当Queue.put(item, False)</li>
  <li>Queue.task_done() 在完成一项工作之后，Queue.task_done()函数向任务已经完成的队列发送一个信号</li>
  <li>Queue.join() 实际上意味着等到队列为空，再执行别的操作</li>
</ul>

<p>实例</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/python</span>
<span class="c"># -*- coding: UTF-8 -*-</span>

<span class="kn">import</span> <span class="nn">Queue</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">exitFlag</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">myThread</span> <span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threadID</span> <span class="o">=</span> <span class="n">threadID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">q</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">"Starting "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">process_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">"Exiting "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">def</span> <span class="nf">process_data</span><span class="p">(</span><span class="n">threadName</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">exitFlag</span><span class="p">:</span>
        <span class="n">queueLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">workQueue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">queueLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">"</span><span class="si">%</span><span class="s">s processing </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">threadName</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">queueLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">threadList</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Thread-1"</span><span class="p">,</span> <span class="s">"Thread-2"</span><span class="p">,</span> <span class="s">"Thread-3"</span><span class="p">]</span>
<span class="n">nameList</span> <span class="o">=</span> <span class="p">[</span><span class="s">"One"</span><span class="p">,</span> <span class="s">"Two"</span><span class="p">,</span> <span class="s">"Three"</span><span class="p">,</span> <span class="s">"Four"</span><span class="p">,</span> <span class="s">"Five"</span><span class="p">]</span>
<span class="n">queueLock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
<span class="n">workQueue</span> <span class="o">=</span> <span class="n">Queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">threadID</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c"># 创建新线程</span>
<span class="k">for</span> <span class="n">tName</span> <span class="ow">in</span> <span class="n">threadList</span><span class="p">:</span>
    <span class="n">thread</span> <span class="o">=</span> <span class="n">myThread</span><span class="p">(</span><span class="n">threadID</span><span class="p">,</span> <span class="n">tName</span><span class="p">,</span> <span class="n">workQueue</span><span class="p">)</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>
    <span class="n">threadID</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c"># 填充队列</span>
<span class="n">queueLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">nameList</span><span class="p">:</span>
    <span class="n">workQueue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="n">queueLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="c"># 等待队列清空</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">workQueue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c"># 通知线程是时候退出</span>
<span class="n">exitFlag</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c"># 等待所有线程完成</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
    <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="k">print</span> <span class="s">"Exiting Main Thread"</span></code></pre></div>

<h2 id="python2x3x">Python2.x与3​​.x版本区别</h2>
<p>Python 2.6作为一个过渡版本，基本使用了Python 2.x的语法和库，同时考虑了向Python 3.0的迁移，允许使用部分Python 3.0的语法与函数。 <br /></p>

<h3 id="print">print函数</h3>
<p>print语句没有了，取而代之的是print()函数。Python 2.6与Python 2.7里面，以下三种形式是等价的：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span> <span class="s">"fish"</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"fish"</span><span class="p">)</span> <span class="c">#注意print后面有个空格</span>
<span class="k">print</span><span class="p">(</span><span class="s">"fish"</span><span class="p">)</span> <span class="c">#print()不能带有任何其它参数</span></code></pre></div>

<h3 id="unicode">Unicode</h3>
<p>Python 2 有 ASCII str() 类型，unicode() 是单独的，不是 byte 类型。 <br />
在 Python 3，我们最终有了 Unicode (utf-8) 字符串，以及一个字节类：byte 和 bytearrays。 <br />
由于 Python3.X 源码文件默认使用utf-8编码，这就使得以下代码是合法的：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="err">中国</span> <span class="o">=</span> <span class="s">'china'</span> 
<span class="o">&gt;&gt;&gt;</span><span class="k">print</span><span class="p">(</span><span class="err">中国</span><span class="p">)</span> 
<span class="n">china</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"我爱北京天安门"</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">str</span>
<span class="s">'</span><span class="se">\xe6\x88\x91\xe7\x88\xb1\xe5\x8c\x97\xe4\xba\xac\xe5\xa4\xa9\xe5\xae\x89\xe9\x97\xa8</span><span class="s">'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">u"我爱北京天安门"</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">str</span>
<span class="s">u'</span><span class="se">\u6211\u7231\u5317\u4eac\u5929\u5b89\u95e8</span><span class="s">'</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"我爱北京天安门"</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">str</span>
<span class="s">'我爱北京天安门'</span></code></pre></div>

<h3 id="section-1">除法运算</h3>
<ul>
  <li>在python 2.x中整数相除的结果是一个整数，把小数部分完全忽略掉，浮点数除法会保留小数点的部分得到一个浮点数的结果。</li>
  <li>在python 3.x中/除法不再这么做了，对于整数之间的相除，结果也会是浮点数。</li>
</ul>

<h3 id="xrange">xrange</h3>
<p>
在 Python 2 中 xrange() 创建迭代对象的用法是非常流行的。比如： for 循环或者是列表/集合/字典推导式。
这个表现十分像生成器（比如。"惰性求值"）。但是这个 xrange-iterable 是无穷的，意味着你可以无限遍历。
由于它的惰性求值，如果你不得仅仅不遍历它一次，xrange() 函数 比 range() 更快（比如 for 循环）。尽管如此，对比迭代一次，不建议你重复迭代多次，因为生成器每次都从头开始。
在 Python 3 中，range() 是像 xrange() 那样实现以至于一个专门的 xrange() 函数都不再存在（在 Python 3 中 xrange() 会抛出命名异常）。
</p>

<h3 id="section-2">八进制字面量表示</h3>
<p>
八进制数必须写成0o777，原来的形式0777不能用了；二进制必须写成0b111。
新增了一个bin()函数用于将一个整数转换成二进制字串。 Python 2.6已经支持这两种语法。
在Python 3.x中，表示八进制字面量的方式只有一种，就是0o1000。
</p>

<h3 id="section-3">不等运算符</h3>
<p>
Python 2.x中不等于有两种写法 != 和 &lt;&gt;
Python 3.x中去掉了&lt;&gt;, 只有!=一种写法，还好，我从来没有使用&lt;&gt;的习惯
</p>

<h3 id="repr">去掉了repr表达式``</h3>
<p>
Python 2.x 中反引号``相当于repr函数的作用
Python 3.x 中去掉了``这种写法，只允许使用repr函数，这样做的目的是为了使代码看上去更清晰么？不过我感觉用repr的机会很少，一般只在debug的时候才用，多数时候还是用str函数来用字符串描述对象。
</p>

<h3 id="pep8">多个模块被改名（根据PEP8）</h3>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="err">旧的名字</span>	        <span class="err">新的名字</span>
<span class="n">_winreg</span>	            <span class="n">winreg</span>
<span class="n">ConfigParser</span>	    <span class="n">configparser</span>
<span class="n">copy_reg</span>	        <span class="n">copyreg</span>
<span class="n">Queue</span>	            <span class="n">queue</span>
<span class="n">SocketServer</span>	    <span class="n">socketserver</span>
<span class="nb">repr</span>	            <span class="n">reprlib</span></code></pre></div>

<h3 id="section-4">数据类型</h3>
<ul>
  <li>Py3.X去除了long类型，现在只有一种整型——int，但它的行为就像2.X版本的long</li>
  <li>新增了bytes类型，对应于2.X版本的八位串，定义一个bytes字面量的方法如下：</li>
</ul>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="s">'china'</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> 
<span class="o">&lt;</span><span class="nb">type</span> <span class="s">'bytes'</span><span class="o">&gt;</span></code></pre></div>

<ul>
  <li>dict的.keys()、.items 和.values()方法返回迭代器，而之前的iterkeys()等函数都被废弃。同时去掉的还有 dict.has_key()，用 in替代它吧 。</li>
</ul>


    </div>

  
    <ul class="tag_box inline">
      <li><i class="glyphicon glyphicon-open"></i></li>
      
      


  
     
    	<li><a href="/10-categories.html#python-ref">
    		python <span>4</span>
    	</a></li>
    
  



    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="glyphicon glyphicon-tags"></i></li>
      
      


  
     
    	<li><a href="/20-tags.html#Python-ref">Python <span>4</span></a></li>
    
  



    </ul>
    
  
    <hr>
    <ul class="pagination">
    
      <li class="prev"><a href="/python/2014/03/01/Python-notes3" title="Python学习笔记（三）">&laquo; 上一篇</a></li>
    
      <li><a href="/30-archive.html">归档</a></li>
    
      <li class="next"><a href="/linux/2014/07/23/ubuntu-timezone" title="Ubuntu时区设置">下一篇 &raquo;</a></li>
    
    </ul>
    <hr>
    


  <!-- Duoshuo Comment BEGIN -->
    <div id="comments">
        <div class="ds-thread" data-thread-key="/python/2014/03/01/Python-notes4"  data-title="Python学习笔记（四） - 龙棠博客"></div>
    </div>
<!-- Duoshuo Comment END -->





  </div>
</div>


      </div>

    </div>

    <div id="footer">
      <div class="container">
        <p>&copy; 2016 龙棠博客
        </p>
      </div>
    </div>
    <!--多说js加载开始，一个页面只需要加载一次 -->
    <script type="text/javascript">
      var duoshuoQuery = {short_name:"longtang"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = 'http://static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
    </script>
    <!--多说js加载结束，一个页面只需要加载一次 -->
    

    <script src="/js/jquery-1.9.1.min.js"></script>
    <script>
    $(function () {
        var elm = $('.navbar');
        var startPos = $(elm).offset().top;
        $.event.add(window, "scroll", function () {
            var p = $(window).scrollTop();
            $(elm).css('position', ((p) > startPos) ? 'fixed' : 'static');
            $(elm).css('top', ((p) > startPos) ? '0px' : "");
        });
    });    
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-56471525-1', 'auto');
     ga('send', 'pageview');
    </script>
    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!--script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script-->
    <script src="/assets/themes/bootstrap-3/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

